<script>
    // Scene, Camera, Renderer
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Orbit Controls
    const controls = new THREE.OrbitControls(camera, renderer.domElement);

    // Lights
    const pointLight = new THREE.PointLight(0xffffff, 1, 100);
    pointLight.position.set(10, 10, 10);
    scene.add(pointLight);

    const ambientLight = new THREE.AmbientLight(0x404040); // Soft white light
    scene.add(ambientLight);

    // Planet and Moon Groups
    const planetGroup = new THREE.Group();
    const moonGroup = new THREE.Group();

    // Create Planet (Sphere)
    const planetGeometry = new THREE.SphereGeometry(1, 32, 32);
    const planetMaterial = new THREE.MeshStandardMaterial({ color: 0x85C1E9 });
    const planet = new THREE.Mesh(planetGeometry, planetMaterial);
    planetGroup.add(planet);

    // Add planet group to scene
    scene.add(planetGroup);
    planetGroup.add(moonGroup);

    // Land Mesh (optional)
    let landMesh = null;

    // Position camera
    camera.position.z = 5;

    // Update planet appearance
    function updatePlanet(mass, temperature, moonCount, color, addLand) {
        console.log("Updating Planet:", { mass, temperature, moonCount, color, addLand });

        // Change planet size based on mass
        const scale = mass / 10;
        planet.scale.set(scale, scale, scale);

        // Change planet color
        planetMaterial.color.set(color);

        // Land Feature Toggle
        if (addLand && !landMesh) {
            const landGeometry = new THREE.SphereGeometry(1.02, 32, 32);
            const landMaterial = new THREE.MeshStandardMaterial({
                color: 0x228B22,
                wireframe: true,
                transparent: true,
                opacity: 0.5,
            });
            landMesh = new THREE.Mesh(landGeometry, landMaterial);
            planetGroup.add(landMesh);
        } else if (!addLand && landMesh) {
            planetGroup.remove(landMesh);
            landMesh = null;
        }

        // Transition to Black Hole if mass exceeds threshold
        if (mass > 50) {
            planetMaterial.color.set(0x000000); // Black
            planetMaterial.emissive.set(0x222222); // Glow effect
            planet.scale.set(0.5, 0.5, 0.5); // Shrink into singularity
        }

        // Update moons
        moonGroup.clear();
        for (let i = 0; i < moonCount; i++) {
            const moonGeometry = new THREE.SphereGeometry(0.1, 16, 16);
            const moonMaterial = new THREE.MeshStandardMaterial({ color: 0xAAAAAA });
            const moon = new THREE.Mesh(moonGeometry, moonMaterial);

            // Position moons in orbit
            const angle = (i / moonCount) * Math.PI * 2;
            const radius = scale + 0.5;
            moon.position.set(
                radius * Math.cos(angle),
                radius * Math.sin(angle),
                0
            );

            moonGroup.add(moon);
        }
    }

    // Sliders and Controls
    const massSlider = document.getElementById("mass");
    const temperatureSlider = document.getElementById("temperature");
    const moonsSlider = document.getElementById("moons");
    const colorPicker = document.getElementById("color");
    const landToggle = document.getElementById("land");

    const massValue = document.getElementById("mass-value");
    const temperatureValue = document.getElementById("temperature-value");
    const moonsValue = document.getElementById("moons-value");

    function updateSliders() {
        const mass = parseFloat(massSlider.value);
        const temperature = parseFloat(temperatureSlider.value);
        const moons = parseInt(moonsSlider.value);
        const color = colorPicker.value;
        const addLand = landToggle.checked;

        massValue.textContent = mass.toFixed(1);
        temperatureValue.textContent = temperature.toFixed(0);
        moonsValue.textContent = moons;

        updatePlanet(mass, temperature, moons, color, addLand);

        const description = document.getElementById("description");
        if (mass > 50) {
            description.textContent = "The planet has collapsed into a black hole!";
        } else {
            description.textContent = "Adjust the sliders to create your planet. If the mass exceeds 50, the planet will collapse into a black hole!";
        }
    }

    massSlider.addEventListener("input", updateSliders);
    temperatureSlider.addEventListener("input", updateSliders);
    moonsSlider.addEventListener("input", updateSliders);
    colorPicker.addEventListener("input", updateSliders);
    landToggle.addEventListener("change", updateSliders);

    // Animation Loop
    function animate() {
        requestAnimationFrame(animate);

        // Rotate planet and moons
        planet.rotation.y += 0.005;
        moonGroup.rotation.y += 0.01;

        controls.update();
        renderer.render(scene, camera);
    }

    updateSliders(); // Initialize with default values
    animate();
</script>
